# ADR-004: v2ディレクトリ構成の再編とモデル管理方針

## ステータス
提案中 (Proposed)

## コンテキスト
現在、`v2` ディレクトリには以下の要素がフラットに混在しており、役割分担が不明確になっている。

1.  **分析ツール**: `inspector.py`, `diagnostician.py` など、音声品質を評価するユーティリティ。
2.  **実験的ノートブック**: `qwen4 copy.ipynb`, `rora.ipynb` など、新しいモデル（Qwen-TTS, PEFT/LoRA）を検証するためのコード。
3.  **ドキュメント**: `docs/` 以下に旧来の方針（XTTS/RVC）が記載されているが、実態（Qwen/PEFT）と乖離し始めている。

このままでは、どのファイルが「再利用可能なコンポーネント」で、どれが「使い捨ての実験コード」なのか判別しづらい。また、Qwen-TTSなどの新しいモデルを導入する際、どこに実装を置くべきかの指針がない。

## 決定事項
`v2` ディレクトリの構造を以下のように再編し、役割を明確化する。

### 1. ディレクトリ構成の定義

```
v2/
├── models/         # 再利用可能なモデル定義、ラッパー、学習スクリプト
│   ├── qwen/       # Qwen-TTS関連
│   └── peft/       # PEFT/LoRA学習関連
├── experiments/    # 検証用ノートブック、一時的な実験コード
│   ├── qwen_poc/   # Qwen-TTSの検証
│   └── lora_poc/   # LoRA学習の検証
├── tools/          # 汎用的な分析・診断・前処理ツール
│   ├── inspector.py
│   └── diagnostician.py
└── docs/
    └── adr/        # Architecture Decision Records
```

### 2. モデル採用方針の更新
既存のドキュメントでは **Coqui XTTS-v2 + RVC** を推奨していたが、v2フェーズでは以下のモデルも検証・採用対象として正式に扱う。

*   **Qwen-TTS**: 高品質なゼロショット音声合成の有力候補として検証を行う。
*   **PEFT (LoRA)**: 大規模モデルの効率的なファインチューニング手法として、実装を `models/peft/` に集約する。

### 3. 実装の移行
*   既存の `*.ipynb` ファイルは、原則として `experiments/` ディレクトリへ移動する。
*   ノートブック内で定義されているクラスや関数（例: 推論ロジック）は、安定した段階で `models/` 内のPythonモジュールへ切り出す。

## 結果 (Consequences)

### メリット
*   **関心の分離**: 実験コードと本番用ライブラリコードが分離され、メンテナンス性が向上する。
*   **可読性**: 新規参画者がプロジェクト構造を把握しやすくなる。
*   **拡張性**: 新しいモデル（例: F5-TTSなど）を試す際、`experiments/` で試し、`models/` に昇格させるフローが確立する。

### デメリット
*   **パスの修正**: ノートブックを移動するため、ファイルパス（`../text.json` など）の修正が必要になる。
*   **移行コスト**: 既存ファイルの移動とリファクタリングの手間が発生する。

## 補足
本ADRの作成に伴い、既存の `v2/docs/ADR.md` は `v2/docs/adr/0001-legacy-architecture.md` (仮) として扱い、今後は `v2/docs/adr/` 下でナンバリング管理を行う。
